<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Msgly AI</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-purple: #8039DF;
            --dark-purple: #3E0075;
            --glow-purple: #9F4EFF;
            --neon-purple: #7B2CBF;
            --electric-purple: #6A1B9A;
            --light-purple: #F5EDFF;
            --accent-pink: #FF2370;
            --success-green: #10B981;
            --warning-orange: #F59E0B;
            --error-red: #EF4444;
            --black: #111827;
            --charcoal: #1F2937;
            --dark-gray: #374151;
            --gray: #6B7280;
            --light-gray: #F9FAFB;
            --white: #FFFFFF;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.12);
            --glow-shadow: 0 0 30px rgba(128, 57, 223, 0.25);
            --intense-glow: 0 0 45px rgba(128, 57, 223, 0.35);
            --neon-glow: 0 0 60px rgba(128, 57, 223, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--light-gray);
            min-height: 100vh;
            display: flex;
        }

        /* Side Navigation */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--primary-purple) 0%, var(--dark-purple) 100%);
            color: var(--white);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
            transition: transform 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-header {
            padding: 2rem 1.5rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--white);
            margin-bottom: 1rem;
        }

        .sidebar-logo i {
            font-size: 2rem;
            margin-right: 12px;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
        }

        .sidebar-logo-text {
            display: flex;
            flex-direction: column;
        }

        .sidebar-logo-main {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .sidebar-logo-sub {
            font-size: 0.7rem;
            opacity: 0.8;
            font-weight: 400;
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .sidebar-user-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .sidebar-user-info {
            flex: 1;
            min-width: 0;
        }

        .sidebar-user-name {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-user-email {
            font-size: 0.75rem;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-nav {
            padding: 1.5rem 0;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            padding: 0 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: var(--white);
            box-shadow: inset 4px 0 0 var(--white);
        }

        .nav-item i {
            width: 20px;
            margin-right: 12px;
            font-size: 1.1rem;
        }

        .nav-item-text {
            font-size: 0.9rem;
            font-weight: 500;
            flex: 1;
        }

        .coming-soon-badge {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logout-btn {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--white);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Mobile Sidebar Toggle */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: var(--primary-purple);
            color: var(--white);
            border: none;
            border-radius: 8px;
            padding: 0.75rem;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        /* Main Content */
        .main-wrapper {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        .main-content {
            padding: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header {
            margin-bottom: 1.5rem;
        }

        .page-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.4rem;
        }

        .page-subtitle {
            color: var(--gray);
            font-size: 1rem;
        }

        /* UPGRADE SUCCESS/ERROR NOTIFICATIONS */
        .notification-banner {
            border-radius: 14px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            display: none;
            animation: slideInDown 0.5s ease-out;
            position: relative;
        }

        .notification-banner.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 2px solid var(--success-green);
        }

        .notification-banner.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 2px solid var(--error-red);
        }

        .notification-banner.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
            border: 2px solid var(--warning-orange);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .notification-icon {
            width: 22px;
            height: 22px;
            font-size: 1.1rem;
        }

        .notification-banner.success .notification-icon {
            color: var(--success-green);
        }

        .notification-banner.error .notification-icon {
            color: var(--error-red);
        }

        .notification-banner.warning .notification-icon {
            color: var(--warning-orange);
        }

        .notification-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .notification-banner.success .notification-title {
            color: var(--success-green);
        }

        .notification-banner.error .notification-title {
            color: var(--error-red);
        }

        .notification-banner.warning .notification-title {
            color: var(--warning-orange);
        }

        .notification-message {
            color: var(--dark-gray);
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .notification-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.2rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .notification-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--black);
        }

        /* TRAFFIC LIGHT SYSTEM */
        .traffic-light-warning {
            border-radius: 14px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            display: none;
            animation: slideInDown 0.5s ease-out;
        }

        .traffic-light-warning.red {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 2px solid var(--error-red);
        }

        .traffic-light-warning.orange {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
            border: 2px solid var(--warning-orange);
        }

        .traffic-light-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .traffic-light-icon {
            width: 22px;
            height: 22px;
            font-size: 1.1rem;
        }

        .traffic-light-warning.red .traffic-light-icon {
            color: var(--error-red);
        }

        .traffic-light-warning.orange .traffic-light-icon {
            color: var(--warning-orange);
        }

        .traffic-light-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .traffic-light-warning.red .traffic-light-title {
            color: var(--error-red);
        }

        .traffic-light-warning.orange .traffic-light-title {
            color: var(--warning-orange);
        }

        .traffic-light-message {
            color: var(--dark-gray);
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .traffic-light-highlight {
            font-weight: 600;
            color: var(--black);
        }

        .download-extension-btn {
            margin-top: 1.2rem;
            width: 100%;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--dark-purple) 100%);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--glow-shadow);
            position: relative;
            overflow: hidden;
        }

        .download-extension-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .download-extension-btn:hover {
            background: linear-gradient(135deg, var(--electric-purple) 0%, var(--primary-purple) 100%);
            transform: translateY(-2px);
            box-shadow: var(--intense-glow);
        }

        .download-extension-btn:hover::before {
            left: 100%;
        }

        .download-extension-btn:active {
            transform: translateY(0);
        }

        .download-extension-btn i {
            font-size: 1.2rem;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }

        .orange-progress {
            margin-top: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(245, 158, 11, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--warning-orange) 0%, #D97706 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .progress-text {
            font-size: 0.8rem;
            color: var(--warning-orange);
            font-weight: 600;
            min-width: 100px;
        }

        /* Dashboard Grid - Optimized for smaller cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .dashboard-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.2rem;
            margin-bottom: 1.5rem;
        }

        /* Section Containers */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Optimized Card Styles */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 1.2rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(128, 57, 223, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-purple) 0%, var(--electric-purple) 100%);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--dark-purple) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.1rem;
            box-shadow: var(--glow-shadow);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--black);
        }

        /* MESSAGES SECTION STYLES */
        .messages-section {
            max-width: 100%;
        }

        .messages-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .messages-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--black);
        }

        .messages-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            background: var(--white);
            color: var(--dark-gray);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: var(--glow-shadow);
        }

        .refresh-btn {
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--dark-purple) 100%);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .refresh-btn:hover {
            background: linear-gradient(135deg, var(--electric-purple) 0%, var(--primary-purple) 100%);
            transform: translateY(-1px);
            box-shadow: var(--glow-shadow);
        }

        /* Messages Table - Desktop */
        .messages-table-container {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(128, 57, 223, 0.08);
        }

        .messages-table {
            width: 100%;
            border-collapse: collapse;
        }

        .messages-table thead {
            background: linear-gradient(135deg, var(--light-purple) 0%, rgba(128, 57, 223, 0.1) 100%);
        }

        .messages-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 700;
            color: var(--dark-purple);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--primary-purple);
        }

        .messages-table tbody tr {
            border-bottom: 1px solid var(--light-gray);
            transition: all 0.3s ease;
        }

        .messages-table tbody tr:hover {
            background: linear-gradient(135deg, var(--light-purple) 0%, rgba(128, 57, 223, 0.05) 100%);
        }

        .messages-table td {
            padding: 1rem;
            vertical-align: top;
            font-size: 0.9rem;
        }

        /* Message Content */
        .message-content {
            max-width: 300px;
            position: relative;
        }

        .message-preview {
            color: var(--dark-gray);
            line-height: 1.4;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .message-preview:hover {
            color: var(--primary-purple);
        }

        .message-full {
            display: none;
            color: var(--dark-gray);
            line-height: 1.5;
            margin-top: 0.5rem;
            padding: 1rem;
            background: var(--light-gray);
            border-radius: 10px;
            border-left: 4px solid var(--primary-purple);
        }

        .expand-toggle {
            color: var(--primary-purple);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
        }

        .expand-toggle:hover {
            color: var(--electric-purple);
            transform: translateX(2px);
        }

        /* Target Profile */
        .target-profile {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .profile-name {
            font-weight: 700;
            color: var(--black);
            font-size: 0.9rem;
        }

        .profile-role {
            color: var(--dark-gray);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .profile-company {
            color: var(--primary-purple);
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Status Toggle Switches */
        .status-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--light-gray);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--gray);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, var(--success-green) 0%, #059669 100%);
            border-color: var(--success-green);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }

        .toggle-switch.inactive {
            background: linear-gradient(135deg, var(--error-red) 0%, #DC2626 100%);
            border-color: var(--error-red);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .toggle-switch.unsaved {
            border-color: var(--warning-orange);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
        }

        .toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: var(--white);
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .toggle-switch.active .toggle-knob {
            transform: translateX(30px);
            color: var(--success-green);
        }

        .toggle-switch.inactive .toggle-knob {
            transform: translateX(30px);
            color: var(--error-red);
        }

        .toggle-switch.unknown .toggle-knob {
            transform: translateX(15px);
            background: var(--gray);
            color: var(--white);
        }

        .toggle-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toggle-switch.active + .toggle-label {
            color: var(--success-green);
        }

        .toggle-switch.inactive + .toggle-label {
            color: var(--error-red);
        }

        .toggle-switch.unknown + .toggle-label {
            color: var(--gray);
        }

        /* Comment Field */
        .comment-field {
            width: 100%;
            min-height: 60px;
            max-height: 120px;
            padding: 0.7rem;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            resize: vertical;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .comment-field:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: var(--glow-shadow);
        }

        .comment-field.unsaved {
            border-color: var(--warning-orange);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, var(--white) 100%);
        }

        /* Action Buttons */
        .actions-cell {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 100px;
        }

        .save-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .save-btn.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .save-btn.visible {
            opacity: 1;
            background: linear-gradient(135deg, var(--warning-orange) 0%, #D97706 100%);
            color: var(--white);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .save-btn.visible:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        .save-btn.saving {
            background: var(--gray);
            cursor: not-allowed;
        }

        .save-btn.saved {
            background: var(--success-green);
            animation: savedPulse 0.5s ease;
        }

        @keyframes savedPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Messages Cards for Mobile */
        .messages-cards {
            display: none;
        }

        .message-card {
            background: var(--white);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(128, 57, 223, 0.08);
            transition: all 0.3s ease;
        }

        .message-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .message-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .message-card-profile {
            flex: 1;
        }

        .message-card-name {
            font-weight: 700;
            color: var(--black);
            font-size: 1rem;
            margin-bottom: 0.3rem;
        }

        .message-card-role {
            color: var(--dark-gray);
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
        }

        .message-card-company {
            color: var(--primary-purple);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .message-card-toggles {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            align-items: flex-end;
        }

        .message-card-content {
            margin-bottom: 1rem;
        }

        .message-card-comment {
            margin-bottom: 1rem;
        }

        .message-card-actions {
            display: flex;
            justify-content: flex-end;
        }

        /* Optimized Account Info Card */
        .account-info-grid {
            display: grid;
            gap: 0.8rem;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.7rem 0.9rem;
            background: var(--light-gray);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .info-item:hover {
            background: var(--light-purple);
            transform: translateX(2px);
        }

        .info-label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--dark-gray);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .info-label i {
            color: var(--primary-purple);
            width: 14px;
            font-size: 0.9rem;
        }

        .info-value {
            color: var(--black);
            font-weight: 600;
            font-size: 0.8rem;
        }

        /* Optimized Subscription Card */
        .subscription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .plan-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--success-green) 0%, #059669 100%);
            color: var(--white);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            box-shadow: 0 3px 12px rgba(16, 185, 129, 0.25);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 0.4rem 0.8rem;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: linear-gradient(135deg, var(--success-green) 0%, #059669 100%);
            color: var(--white);
        }

        .credits-display {
            display: flex;
            align-items: center;
            gap: 1.2rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--light-purple) 0%, rgba(128, 57, 223, 0.08) 100%);
            border-radius: 12px;
            margin: 1rem 0;
            border: 1px solid rgba(128, 57, 223, 0.15);
        }

        .credits-number {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--primary-purple);
            text-shadow: 0 2px 4px rgba(128, 57, 223, 0.15);
        }

        .credits-info {
            flex: 1;
        }

        .credits-text {
            color: var(--dark-gray);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .credits-details {
            color: var(--gray);
            font-size: 0.75rem;
            line-height: 1.3;
        }

        .subscription-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
            margin: 1rem 0;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            padding: 0.7rem;
            background: var(--light-gray);
            border-radius: 10px;
        }

        .detail-label {
            font-size: 0.7rem;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .detail-value {
            font-size: 0.9rem;
            color: var(--black);
            font-weight: 700;
        }

        .upgrade-btn {
            width: 100%;
            padding: 0.8rem 1.2rem;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--dark-purple) 100%);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--glow-shadow);
        }

        .upgrade-btn:hover {
            background: linear-gradient(135deg, var(--electric-purple) 0%, var(--primary-purple) 100%);
            transform: translateY(-1px);
            box-shadow: var(--intense-glow);
        }

        /* Optimized LinkedIn Profile Card */
        .profile-summary {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.2rem;
        }

        .profile-avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--dark-purple) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.8rem;
            font-weight: 700;
            box-shadow: var(--glow-shadow);
        }

        .profile-details {
            flex: 1;
        }

        .profile-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.3rem;
        }

        .profile-headline {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .profile-company {
            color: var(--dark-gray);
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
            font-weight: 600;
        }

        .profile-location {
            color: var(--gray);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .profile-url {
            background: var(--light-gray);
            padding: 0.7rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .profile-url a {
            color: var(--primary-purple);
            text-decoration: none;
            font-size: 0.8rem;
            word-break: break-all;
            font-weight: 500;
        }

        .view-profile-btn {
            width: 100%;
            padding: 0.7rem;
            border: none;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .view-profile-btn.disabled {
            background: var(--light-gray);
            color: var(--gray);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .view-profile-btn.enabled {
            background: linear-gradient(135deg, var(--success-green) 0%, #059669 100%);
            color: var(--white);
            box-shadow: 0 3px 12px rgba(16, 185, 129, 0.25);
        }

        .view-profile-btn.enabled:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.35);
        }

        /* Optimized Analytics Card */
        .analytics-placeholder {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--gray);
        }

        .analytics-placeholder i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-purple);
            opacity: 0.6;
        }

        .analytics-placeholder h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--dark-gray);
        }

        .analytics-placeholder p {
            font-size: 0.85rem;
            line-height: 1.4;
        }

        /* FULL PROFILE VIEW SECTION */
        .full-profile-section {
            display: none;
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(16, 185, 129, 0.2);
            position: relative;
        }

        .full-profile-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success-green) 0%, #059669 100%);
        }

        .full-profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-gray);
        }

        .full-profile-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--success-green) 0%, #059669 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.4rem;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .full-profile-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--success-green);
        }

        .full-profile-close {
            margin-left: auto;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .full-profile-close:hover {
            background: var(--light-gray);
            color: var(--black);
        }

        .full-profile-content {
            display: grid;
            gap: 2rem;
        }

        .profile-section {
            background: var(--light-gray);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .profile-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-section-title i {
            color: var(--success-green);
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 1rem;
            background: var(--white);
            border-radius: 12px;
            border-left: 4px solid var(--success-green);
        }

        .profile-item-label {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 120px;
        }

        .profile-item-value {
            color: var(--black);
            font-weight: 500;
            flex: 1;
            text-align: right;
        }

        .experience-item, .education-item, .skill-item, .certification-item, .award-item {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--success-green);
            transition: all 0.3s ease;
        }

        .experience-item:hover, .education-item:hover, .skill-item:hover, .certification-item:hover, .award-item:hover {
            box-shadow: var(--shadow);
            transform: translateX(4px);
        }

        .item-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.5rem;
        }

        .item-company {
            font-size: 1rem;
            color: var(--success-green);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .item-duration {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .item-description {
            color: var(--dark-gray);
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .skill-item {
            text-align: center;
            padding: 1rem;
        }

        .skill-name {
            font-weight: 600;
            color: var(--black);
            margin-bottom: 0.5rem;
        }

        .skill-endorsements {
            font-size: 0.85rem;
            color: var(--success-green);
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            flex-direction: column;
            gap: 1.5rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--primary-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Error State */
        .error {
            text-align: center;
            padding: 3rem;
            color: var(--error-red);
        }

        .error i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        /* Empty State for Messages */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            color: var(--primary-purple);
            opacity: 0.6;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 0.8rem;
            color: var(--dark-gray);
            font-weight: 700;
        }

        .empty-state p {
            font-size: 1rem;
            line-height: 1.5;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .dashboard-row {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .subscription-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: block;
            }

            .main-wrapper {
                margin-left: 0;
            }

            .main-content {
                padding: 1rem;
                margin-top: 4rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .card {
                padding: 1rem;
            }

            .profile-summary {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .profile-avatar {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }

            .credits-display {
                flex-direction: column;
                text-align: center;
                gap: 0.8rem;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }

            .skills-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            /* Messages Mobile View */
            .messages-table-container {
                display: none;
            }

            .messages-cards {
                display: block;
            }

            .messages-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .messages-controls {
                width: 100%;
                justify-content: space-between;
            }

            .filter-select {
                flex: 1;
                margin-right: 1rem;
            }
        }

        /* Desktop Messages View - Keep table for larger screens */
        @media (min-width: 769px) {
            .messages-table-container {
                display: block;
            }

            .messages-cards {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Sidebar Toggle -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Side Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="/dashboard" class="sidebar-logo">
                <i class="fas fa-comments"></i>
                <div class="sidebar-logo-text">
                    <div class="sidebar-logo-main">Msgly.AI</div>
                    <div class="sidebar-logo-sub">By Chopa AI LTD</div>
                </div>
            </a>
            
            <div class="sidebar-user">
                <div class="sidebar-user-avatar" id="sidebarUserAvatar">??</div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name" id="sidebarUserName">Loading...</div>
                    <div class="sidebar-user-email" id="sidebarUserEmail">Loading...</div>
                </div>
            </div>
        </div>

        <div class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main Menu</div>
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="nav-item-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('messages')">
                    <i class="fas fa-envelope"></i>
                    <span class="nav-item-text">Messages</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('analytics')">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-item-text">Analytics</span>
                    <span class="coming-soon-badge">Soon</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('linkedin-profile')">
                    <i class="fab fa-linkedin"></i>
                    <span class="nav-item-text">LinkedIn Profile</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Account</div>
                <a href="#" class="nav-item" onclick="showSection('profile')">
                    <i class="fas fa-user-circle"></i>
                    <span class="nav-item-text">Profile</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('billing')">
                    <i class="fas fa-credit-card"></i>
                    <span class="nav-item-text">Billing</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    <span class="nav-item-text">Settings</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Support</div>
                <a href="#" class="nav-item" onclick="showSection('help')">
                    <i class="fas fa-question-circle"></i>
                    <span class="nav-item-text">Help Center</span>
                </a>
            </div>
        </div>

        <div class="sidebar-footer">
            <a href="#" class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </a>
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <div class="main-wrapper">
        <main class="main-content">
            <!-- UPGRADE SUCCESS/ERROR NOTIFICATIONS -->
            <div class="notification-banner success" id="successNotification">
                <button class="notification-close" onclick="closeNotification('successNotification')">
                    <i class="fas fa-times"></i>
                </button>
                <div class="notification-header">
                    <i class="fas fa-check-circle notification-icon"></i>
                    <div class="notification-title">Upgrade Successful!</div>
                </div>
                <div class="notification-message" id="successMessage">
                    Welcome to your new plan! Your credits have been updated and are ready to use.
                </div>
            </div>

            <div class="notification-banner error" id="errorNotification">
                <button class="notification-close" onclick="closeNotification('errorNotification')">
                    <i class="fas fa-times"></i>
                </button>
                <div class="notification-header">
                    <i class="fas fa-exclamation-triangle notification-icon"></i>
                    <div class="notification-title">Upgrade Failed</div>
                </div>
                <div class="notification-message" id="errorMessage">
                    There was an issue processing your upgrade. Please try again or contact support.
                </div>
            </div>

            <div class="notification-banner warning" id="cancelNotification">
                <button class="notification-close" onclick="closeNotification('cancelNotification')">
                    <i class="fas fa-times"></i>
                </button>
                <div class="notification-header">
                    <i class="fas fa-info-circle notification-icon"></i>
                    <div class="notification-title">Upgrade Cancelled</div>
                </div>
                <div class="notification-message" id="cancelMessage">
                    No worries! Your upgrade was cancelled and no charges were made. You can upgrade anytime.
                </div>
            </div>

            <!-- TRAFFIC LIGHT WARNING SYSTEM -->
            <div class="traffic-light-warning red" id="redWarning">
                <div class="traffic-light-header">
                    <i class="fas fa-exclamation-triangle traffic-light-icon"></i>
                    <div class="traffic-light-title">Your profile is not fully synced yet.</div>
                </div>
                <div class="traffic-light-message">
                    To personalize your outreach messages at the highest level, we first need a complete view of your LinkedIn profile. Please visit <span class="traffic-light-highlight">your own LinkedIn profile</span> with the Msgly.AI Chrome extension installed and active  this will automatically sync your data. Once completed, you'll unlock the full power of our AI-generated messages.
                </div>
                <button class="download-extension-btn" onclick="downloadChromeExtension()">
                    <i class="fab fa-chrome"></i>
                    Download Chrome Extension
                </button>
            </div>

            <div class="traffic-light-warning orange" id="orangeWarning">
                <div class="traffic-light-header">
                    <i class="fas fa-cog fa-spin traffic-light-icon"></i>
                    <div class="traffic-light-title">Analyzing Profile</div>
                </div>
                <div class="traffic-light-message">
                    We're analyzing your profile data. This usually takes a few minutes. Once completed, you'll unlock the full power of our AI-generated messages.
                </div>
                <div class="orange-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="analysisProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progressText">Processing...</div>
                </div>
            </div>

            <!-- DASHBOARD SECTION -->
            <div id="dashboardSection" class="section active">
                <!-- Page Header -->
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Welcome to your AI-powered LinkedIn messaging center</p>
                </div>

                <!-- Loading State -->
                <div class="loading" id="loadingState">
                    <div class="spinner"></div>
                    <p>Loading your dashboard...</p>
                </div>

                <!-- Error State -->
                <div class="error" id="errorState" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Unable to load dashboard</h3>
                    <p id="errorMessage">Please try refreshing the page or logging in again.</p>
                </div>

                <!-- Dashboard Content -->
                <div id="dashboardContent" style="display: none;">
                    <!-- Top Row: Account Info and Subscription -->
                    <div class="dashboard-row">
                        <!-- Enhanced Account Information -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <h3 class="card-title">Account Information</h3>
                            </div>
                            
                            <div class="account-info-grid">
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fas fa-user"></i>
                                        Full Name
                                    </div>
                                    <div class="info-value" id="accountFullName">Loading...</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fas fa-envelope"></i>
                                        Email Address
                                    </div>
                                    <div class="info-value" id="accountEmail">Loading...</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fas fa-calendar-plus"></i>
                                        Member Since
                                    </div>
                                    <div class="info-value" id="accountSignupDate">Loading...</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fas fa-id-badge"></i>
                                        User ID
                                    </div>
                                    <div class="info-value" id="accountUserId">Loading...</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fas fa-shield-alt"></i>
                                        Account Status
                                    </div>
                                    <div class="info-value" id="accountStatus">Active</div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">
                                        <i class="fas fa-sync-alt"></i>
                                        Profile Status
                                    </div>
                                    <div class="info-value" id="profileSyncStatus">Checking...</div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Subscription & Credits -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <h3 class="card-title">Subscription & Credits</h3>
                            </div>
                            
                            <div class="subscription-header">
                                <div class="plan-badge" id="planBadge">
                                    <i class="fas fa-star"></i>
                                    <span id="currentPlan">Loading...</span>
                                </div>
                                <div class="status-badge status-active" id="statusBadge">
                                    <i class="fas fa-check-circle"></i>
                                    <span id="subscriptionStatus">Active</span>
                                </div>
                            </div>
                            
                            <div class="credits-display">
                                <div class="credits-number" id="creditsRemaining">--</div>
                                <div class="credits-info">
                                    <div class="credits-text">Credits Remaining</div>
                                    <div class="credits-details" id="creditsDetails">
                                        <span id="creditBreakdown">Loading...</span><br>
                                        <span id="renewalInfo">Loading...</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="subscription-details">
                                <div class="detail-item">
                                    <div class="detail-label">Billing Model</div>
                                    <div class="detail-value" id="billingModel">Monthly</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Messages Sent</div>
                                    <div class="detail-value" id="messagesSent">0</div>
                                </div>
                            </div>
                            
                            <button class="upgrade-btn" onclick="upgradeAccount()">
                                <i class="fas fa-rocket"></i>
                                Upgrade Plan / Buy Credits
                            </button>
                        </div>
                    </div>

                    <!-- Bottom Row: LinkedIn Profile -->
                    <div class="dashboard-row">
                        <!-- LinkedIn Profile Summary -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fab fa-linkedin"></i>
                                </div>
                                <h3 class="card-title">LinkedIn Profile Summary</h3>
                            </div>
                            
                            <div class="profile-summary">
                                <div class="profile-avatar" id="profileAvatar">
                                    <span id="profileInitials">--</span>
                                </div>
                                <div class="profile-details">
                                    <div class="profile-name" id="profileFullName">Loading...</div>
                                    <div class="profile-headline" id="profileHeadline">Loading...</div>
                                    <div class="profile-company" id="profileCompany">Loading...</div>
                                    <div class="profile-location" id="profileLocation">
                                        <i class="fas fa-map-marker-alt"></i>
                                        Loading...
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-url">
                                <a href="#" id="profileUrl" target="_blank">Loading...</a>
                            </div>
                            
                            <button class="view-profile-btn disabled" id="viewProfileBtn" onclick="showFullProfile()">
                                <i class="fas fa-sync-alt"></i>
                                <span id="profileBtnText">Complete profile sync first</span>
                            </button>
                        </div>

                        <!-- Analytics Placeholder -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h3 class="card-title">Analytics & Performance</h3>
                            </div>
                            
                            <div class="analytics-placeholder">
                                <i class="fas fa-chart-bar"></i>
                                <h3>Analytics Dashboard  Coming Soon</h3>
                                <p>Track your reply rates, message performance, and comprehensive analytics data coming soon!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MESSAGES SECTION -->
            <div id="messagesSection" class="section">
                <div class="messages-header">
                    <div>
                        <h1 class="messages-title">Messages</h1>
                        <p class="page-subtitle">Track your LinkedIn outreach campaigns and responses</p>
                    </div>
                    
                    <div class="messages-controls">
                        <select class="filter-select" id="messageFilter" onchange="filterMessages()">
                            <option value="all">All Messages</option>
                            <option value="sent">Sent</option>
                            <option value="pending">Pending</option>
                            <option value="replied">Got Reply</option>
                            <option value="no-reply">No Reply</option>
                        </select>
                        
                        <button class="refresh-btn" onclick="refreshMessages()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Desktop Table View -->
                <div class="messages-table-container" id="messagesTableContainer">
                    <table class="messages-table">
                        <thead>
                            <tr>
                                <th>Message</th>
                                <th>Target Profile</th>
                                <th>Message Sent</th>
                                <th>Got Reply</th>
                                <th>Comments</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTableBody">
                            <!-- Messages will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Mobile Cards View -->
                <div class="messages-cards" id="messagesCardsContainer">
                    <!-- Message cards will be populated by JavaScript -->
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="messagesEmptyState" style="display: none;">
                    <i class="fas fa-envelope-open-text"></i>
                    <h3>No Messages Yet</h3>
                    <p>Your LinkedIn message campaigns will appear here once you start sending personalized outreach messages through our AI system.</p>
                </div>
            </div>

            <!-- FULL PROFILE VIEW SECTION -->
            <div class="full-profile-section" id="fullProfileSection">
                <div class="full-profile-header">
                    <div class="full-profile-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <h2 class="full-profile-title">Complete LinkedIn Profile</h2>
                    <button class="full-profile-close" onclick="hideFullProfile()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="full-profile-content" id="fullProfileContent">
                    <!-- Profile content will be populated by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentUserData = null;
        let messagesData = [];
        let filteredMessages = [];
        let trafficLightStatus = 'loading';
        let analysisProgressInterval = null;
        let unsavedChanges = new Set(); // Track rows with unsaved changes

        // Sample Messages Data - Replace with actual API calls
        const SAMPLE_MESSAGES = [
            {
                id: 1,
                message: "Hi John, I noticed your impressive work in AI development at TechCorp. I'd love to connect and discuss potential collaboration opportunities in machine learning projects. Would you be open to a brief conversation?",
                targetProfile: {
                    firstName: "John",
                    lastName: "Smith",
                    role: "Senior AI Engineer",
                    company: "TechCorp Solutions"
                },
                sentStatus: true, // true/false/null
                replyStatus: null, // true/false/null  
                comment: "Great background in ML. Follow up in 1 week.",
                sentDate: "2025-01-15T10:30:00Z",
                lastUpdated: "2025-01-15T10:30:00Z"
            },
            {
                id: 2,
                message: "Hello Sarah, your expertise in digital marketing caught my attention. I'm working on some innovative growth strategies and would appreciate your insights. Are you available for a quick chat this week?",
                targetProfile: {
                    firstName: "Sarah",
                    lastName: "Johnson",
                    role: "Marketing Director",
                    company: "GrowthLabs Inc"
                },
                sentStatus: true,
                replyStatus: true,
                comment: "",
                sentDate: "2025-01-14T14:20:00Z",
                lastUpdated: "2025-01-16T09:15:00Z"
            },
            {
                id: 3,
                message: "Hi Mike, I see you're leading product development at StartupX. I'm fascinated by your approach to user experience design and would love to learn from your expertise.",
                targetProfile: {
                    firstName: "Mike",
                    lastName: "Chen",
                    role: "Head of Product",
                    company: "StartupX"
                },
                sentStatus: false,
                replyStatus: null,
                comment: "Need to research their recent product launches before sending.",
                sentDate: null,
                lastUpdated: "2025-01-16T16:45:00Z"
            },
            {
                id: 4,
                message: "Dear Emily, your background in sustainable technology aligns perfectly with our environmental initiatives. I'd be thrilled to discuss how we might collaborate on green tech solutions.",
                targetProfile: {
                    firstName: "Emily",
                    lastName: "Rodriguez",
                    role: "Sustainability Director",
                    company: "EcoTech Innovations"
                },
                sentStatus: true,
                replyStatus: false,
                comment: "No response after 5 days. Consider follow-up.",
                sentDate: "2025-01-12T11:00:00Z",
                lastUpdated: "2025-01-17T13:20:00Z"
            },
            {
                id: 5,
                message: "Hello David, I'm impressed by your fintech innovations at CryptoBank. Given the evolving regulatory landscape, I believe there are valuable insights we could share. Would you be interested in connecting?",
                targetProfile: {
                    firstName: "David",
                    lastName: "Thompson",
                    role: "Chief Technology Officer",
                    company: "CryptoBank Ltd"
                },
                sentStatus: null,
                replyStatus: null,
                comment: "",
                sentDate: null,
                lastUpdated: "2025-01-17T08:30:00Z"
            }
        ];

        // Cleaned initialization - webhook handles registration
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[DASHBOARD] Page loaded - starting authentication...');
            checkAuthentication();
        });

        // Handle URL parameters for upgrade status only
        function checkUpgradeStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const upgradeStatus = urlParams.get('upgrade');
            
            if (upgradeStatus === 'success') {
                window.history.replaceState({}, document.title, window.location.pathname);
                showUpgradeSuccessNotification();
            } else if (upgradeStatus === 'cancelled') {
                window.history.replaceState({}, document.title, window.location.pathname);
                showUpgradeCancelledNotification();
            } else if (upgradeStatus === 'error') {
                window.history.replaceState({}, document.title, window.location.pathname);
                showUpgradeErrorNotification();
            }
        }

        // UPGRADE HANDLING FUNCTIONS
        function showUpgradeSuccessNotification() {
            const notification = document.getElementById('successNotification');
            const message = document.getElementById('successMessage');
            
            message.textContent = 'Payment successful! Your plan has been upgraded and credits are ready to use.';
            notification.style.display = 'block';
            
            setTimeout(() => {
                closeNotification('successNotification');
            }, 10000);
        }

        function showUpgradeErrorNotification() {
            const notification = document.getElementById('errorNotification');
            notification.style.display = 'block';
            
            setTimeout(() => {
                closeNotification('errorNotification');
            }, 8000);
        }

        function showUpgradeCancelledNotification() {
            const notification = document.getElementById('cancelNotification');
            notification.style.display = 'block';
            
            setTimeout(() => {
                closeNotification('cancelNotification');
            }, 6000);
        }

        function closeNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            notification.style.display = 'none';
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function showSection(section) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');

            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });

            // Show selected section
            switch(section) {
                case 'dashboard':
                    document.getElementById('dashboardSection').classList.add('active');
                    break;
                case 'messages':
                    document.getElementById('messagesSection').classList.add('active');
                    loadMessages();
                    break;
                case 'linkedin-profile':
                    if (trafficLightStatus === 'green') {
                        showFullProfile();
                    } else {
                        alert('Complete your LinkedIn profile sync first to access this section.');
                    }
                    break;
                default:
                    document.getElementById('dashboardSection').classList.add('active');
                    alert(`${section.charAt(0).toUpperCase() + section.slice(1)} section coming soon!`);
            }
        }

        // Authentication check - ENHANCED with upgrade status check
        async function checkAuthentication() {
            const token = getAuthToken();
            
            if (!token) {
                console.log('[AUTH] No authentication token found - redirecting to login');
                window.location.href = '/login';
                return;
            }

            checkUpgradeStatus();

            try {
                await loadDashboardData(token);
            } catch (error) {
                console.error('[AUTH] Dashboard load error:', error);
                if (error.message.includes('401') || error.message.includes('403')) {
                    window.location.href = '/login';
                } else {
                    showError('Failed to load dashboard data. Please try refreshing the page or logging in again.');
                }
            }
        }

        function getAuthToken() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlToken = urlParams.get('token');
            
            if (urlToken) {
                localStorage.setItem('authToken', urlToken);
                window.history.replaceState({}, document.title, window.location.pathname);
                return urlToken;
            }
            
            return localStorage.getItem('authToken');
        }

        async function loadDashboardData(token) {
            try {
                const response = await fetch('https://api.msgly.ai/profile', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load profile data');
                }

                currentUserData = data.data;
                populateDashboard(data.data);
                
            } catch (error) {
                console.error('[API] Error:', error);
                throw error;
            }
        }

        // Simplified populateDashboard - no fallback registration logic
        function populateDashboard(data) {
            const { user, profile, syncStatus } = data;
            
            console.log('[DASHBOARD] Populating dashboard with user data:', {
                userId: user.id,
                registrationCompleted: user.registrationCompleted,
                planCode: user.planCode,
                renewableCredits: user.renewableCredits,
                payasyougoCredits: user.payasyougoCredits,
                totalCredits: user.credits,
                packageType: user.packageType
            });

            // Update sidebar user info
            document.getElementById('sidebarUserName').textContent = user.displayName || user.email;
            document.getElementById('sidebarUserEmail').textContent = user.email;
            const sidebarInitials = getInitials(user.displayName || user.email);
            document.getElementById('sidebarUserAvatar').textContent = sidebarInitials;

            // DETERMINE TRAFFIC LIGHT STATUS
            const isRegistrationComplete = user.registrationCompleted;
            const isInitialScrapingDone = profile?.initialScrapingDone || false;
            const extractionStatus = profile?.extractionStatus || 'pending';
            const hasExperience = profile?.experience && Array.isArray(profile.experience) && profile.experience.length > 0;

            console.log('[TRAFFIC] Traffic Light Debug:', {
                registrationCompleted: isRegistrationComplete,
                initialScrapingDone: isInitialScrapingDone, 
                extractionStatus: extractionStatus,
                hasExperience: hasExperience
            });

            // Determine traffic light state
            if (isRegistrationComplete && isInitialScrapingDone && extractionStatus === 'completed' && hasExperience) {
                trafficLightStatus = 'green';
                hideAllWarnings();
                enableViewProfile();
            } else if (isRegistrationComplete && isInitialScrapingDone) {
                trafficLightStatus = 'orange';
                showOrangeWarning();
                disableViewProfile();
            } else if (isRegistrationComplete) {
                trafficLightStatus = 'red';
                showRedWarning();
                disableViewProfile();
            } else {
                trafficLightStatus = 'red';
                showRedWarning();
                disableViewProfile();
            }

            // Enhanced Account Information
            document.getElementById('accountFullName').textContent = user.displayName || 'Not provided';
            document.getElementById('accountEmail').textContent = user.email;
            document.getElementById('accountSignupDate').textContent = formatDate(user.createdAt);
            document.getElementById('accountUserId').textContent = `#${user.id}`;
            document.getElementById('accountStatus').textContent = 'Active';
            
            // Update profile sync status based on traffic light
            const profileSyncStatusEl = document.getElementById('profileSyncStatus');
            switch(trafficLightStatus) {
                case 'green':
                    profileSyncStatusEl.textContent = ' Fully Synced';
                    profileSyncStatusEl.style.color = 'var(--success-green)';
                    break;
                case 'orange':
                    profileSyncStatusEl.textContent = ' Processing...';
                    profileSyncStatusEl.style.color = 'var(--warning-orange)';
                    break;
                case 'red':
                    profileSyncStatusEl.textContent = ' Sync Required';
                    profileSyncStatusEl.style.color = 'var(--error-red)';
                    break;
            }

            updateSubscriptionDisplay(user);

            // LinkedIn Profile Summary
            if (profile) {
                document.getElementById('profileFullName').textContent = profile.fullName || 'Profile name not synced yet';
                document.getElementById('profileHeadline').textContent = profile.headline || 'Professional headline awaiting sync...';
                
                const companyName = profile.currentCompanyName || profile.currentCompany || 'Company info pending sync...';
                document.getElementById('profileCompany').textContent = companyName;
                
                const locationElement = document.getElementById('profileLocation');
                locationElement.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${profile.location || 'Location awaiting sync...'}`;
                
                const profileUrlElement = document.getElementById('profileUrl');
                if (profile.linkedinUrl) {
                    profileUrlElement.href = profile.linkedinUrl;
                    profileUrlElement.textContent = profile.linkedinUrl;
                } else {
                    profileUrlElement.textContent = 'LinkedIn URL will appear after sync';
                    profileUrlElement.removeAttribute('href');
                }

                const initials = getInitials(profile.fullName || user.displayName || user.email);
                document.getElementById('profileInitials').textContent = initials;
            } else {
                document.getElementById('profileFullName').textContent = 'LinkedIn profile not connected yet';
                document.getElementById('profileHeadline').textContent = 'Connect your profile to see your headline here';
                document.getElementById('profileCompany').textContent = 'Your company info will appear after sync';
                document.getElementById('profileLocation').innerHTML = '<i class="fas fa-map-marker-alt"></i> Location will sync automatically';
                document.getElementById('profileUrl').textContent = 'LinkedIn URL will appear after connection';
                
                const initials = getInitials(user.displayName || user.email);
                document.getElementById('profileInitials').textContent = initials;
            }

            // Show dashboard content
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'block';
        }

        // MESSAGES FUNCTIONALITY
        async function loadMessages() {
            console.log('[MESSAGES] Loading messages...');
            
            try {
                // TODO: Replace with actual API call
                // const response = await fetch('https://api.msgly.ai/messages', {
                //     method: 'GET',
                //     headers: {
                //         'Authorization': `Bearer ${getAuthToken()}`,
                //         'Content-Type': 'application/json'
                //     }
                // });
                // const data = await response.json();
                // messagesData = data.data || [];
                
                // For now, use sample data
                messagesData = SAMPLE_MESSAGES;
                filteredMessages = [...messagesData];
                
                renderMessages();
                
            } catch (error) {
                console.error('[MESSAGES] Error loading messages:', error);
                // Show empty state on error
                document.getElementById('messagesEmptyState').style.display = 'block';
                document.getElementById('messagesTableContainer').style.display = 'none';
                document.getElementById('messagesCardsContainer').style.display = 'none';
            }
        }

        function renderMessages() {
            const tableBody = document.getElementById('messagesTableBody');
            const cardsContainer = document.getElementById('messagesCardsContainer');
            const emptyState = document.getElementById('messagesEmptyState');
            
            if (filteredMessages.length === 0) {
                emptyState.style.display = 'block';
                document.getElementById('messagesTableContainer').style.display = 'none';
                document.getElementById('messagesCardsContainer').style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Render desktop table
            tableBody.innerHTML = '';
            filteredMessages.forEach((message, index) => {
                const row = createMessageTableRow(message, index);
                tableBody.appendChild(row);
            });
            
            // Render mobile cards
            cardsContainer.innerHTML = '';
            filteredMessages.forEach((message, index) => {
                const card = createMessageCard(message, index);
                cardsContainer.appendChild(card);
            });
        }

        function createMessageTableRow(message, index) {
            const row = document.createElement('tr');
            row.id = `message-row-${message.id}`;
            
            const truncatedMessage = truncateText(message.message, 100);
            const profileName = formatProfileName(message.targetProfile.firstName, message.targetProfile.lastName);
            
            row.innerHTML = `
                <td class="message-content">
                    <div class="message-preview" onclick="toggleMessageExpansion(${message.id})">
                        ${truncatedMessage}
                    </div>
                    ${message.message.length > 100 ? `
                        <div class="expand-toggle" onclick="toggleMessageExpansion(${message.id})">
                            <span id="expand-text-${message.id}">Show more</span>
                            <i class="fas fa-chevron-down" id="expand-icon-${message.id}"></i>
                        </div>
                        <div class="message-full" id="message-full-${message.id}">
                            ${message.message}
                        </div>
                    ` : ''}
                </td>
                <td>
                    <div class="target-profile">
                        <div class="profile-name">${profileName}</div>
                        <div class="profile-role">${message.targetProfile.role}</div>
                        <div class="profile-company">${message.targetProfile.company}</div>
                    </div>
                </td>
                <td class="status-cell">
                    <div class="toggle-switch ${getToggleClass(message.sentStatus)}" 
                         onclick="toggleStatus('sent', ${message.id}, this)">
                        <div class="toggle-knob">${getToggleIcon(message.sentStatus)}</div>
                    </div>
                    <div class="toggle-label">${getToggleLabel(message.sentStatus)}</div>
                </td>
                <td class="status-cell">
                    <div class="toggle-switch ${getToggleClass(message.replyStatus)}" 
                         onclick="toggleStatus('reply', ${message.id}, this)">
                        <div class="toggle-knob">${getToggleIcon(message.replyStatus)}</div>
                    </div>
                    <div class="toggle-label">${getToggleLabel(message.replyStatus)}</div>
                </td>
                <td>
                    <textarea class="comment-field" 
                              id="comment-${message.id}"
                              placeholder="Add notes or comments..."
                              onchange="markUnsaved(${message.id})">${message.comment || ''}</textarea>
                </td>
                <td class="actions-cell">
                    <button class="save-btn hidden" 
                            id="save-btn-${message.id}"
                            onclick="saveMessageData(${message.id})">
                        <i class="fas fa-save"></i> Save
                    </button>
                </td>
            `;
            
            return row;
        }

        function createMessageCard(message, index) {
            const card = document.createElement('div');
            card.className = 'message-card';
            card.id = `message-card-${message.id}`;
            
            const truncatedMessage = truncateText(message.message, 120);
            const profileName = formatProfileName(message.targetProfile.firstName, message.targetProfile.lastName);
            
            card.innerHTML = `
                <div class="message-card-header">
                    <div class="message-card-profile">
                        <div class="message-card-name">${profileName}</div>
                        <div class="message-card-role">${message.targetProfile.role}</div>
                        <div class="message-card-company">${message.targetProfile.company}</div>
                    </div>
                    <div class="message-card-toggles">
                        <div class="status-cell">
                            <div class="toggle-switch ${getToggleClass(message.sentStatus)}" 
                                 onclick="toggleStatus('sent', ${message.id}, this)">
                                <div class="toggle-knob">${getToggleIcon(message.sentStatus)}</div>
                            </div>
                            <div class="toggle-label">Sent</div>
                        </div>
                        <div class="status-cell">
                            <div class="toggle-switch ${getToggleClass(message.replyStatus)}" 
                                 onclick="toggleStatus('reply', ${message.id}, this)">
                                <div class="toggle-knob">${getToggleIcon(message.replyStatus)}</div>
                            </div>
                            <div class="toggle-label">Reply</div>
                        </div>
                    </div>
                </div>
                
                <div class="message-card-content">
                    <div class="message-preview" onclick="toggleMessageExpansion(${message.id}, 'card')">
                        ${truncatedMessage}
                    </div>
                    ${message.message.length > 120 ? `
                        <div class="expand-toggle" onclick="toggleMessageExpansion(${message.id}, 'card')">
                            <span id="expand-text-card-${message.id}">Show more</span>
                            <i class="fas fa-chevron-down" id="expand-icon-card-${message.id}"></i>
                        </div>
                        <div class="message-full" id="message-full-card-${message.id}">
                            ${message.message}
                        </div>
                    ` : ''}
                </div>
                
                <div class="message-card-comment">
                    <textarea class="comment-field" 
                              id="comment-card-${message.id}"
                              placeholder="Add notes or comments..."
                              onchange="markUnsaved(${message.id})">${message.comment || ''}</textarea>
                </div>
                
                <div class="message-card-actions">
                    <button class="save-btn hidden" 
                            id="save-btn-card-${message.id}"
                            onclick="saveMessageData(${message.id})">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            `;
            
            return card;
        }

        // Helper functions for message rendering
        function formatProfileName(firstName, lastName) {
            if (!firstName && !lastName) return 'Unknown';
            if (!lastName) return firstName;
            return `${firstName} ${lastName.charAt(0).toUpperCase()}.`;
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        function getToggleClass(status) {
            if (status === null || status === undefined) return 'unknown';
            return status ? 'active' : 'inactive';
        }

        function getToggleIcon(status) {
            if (status === null || status === undefined) return '?';
            return status ? '' : '';
        }

        function getToggleLabel(status) {
            if (status === null || status === undefined) return 'Unknown';
            return status ? 'Yes' : 'No';
        }

        // Message interaction functions
        function toggleMessageExpansion(messageId, type = 'table') {
            const suffix = type === 'card' ? `-card-${messageId}` : `-${messageId}`;
            const fullDiv = document.getElementById(`message-full${suffix}`);
            const expandText = document.getElementById(`expand-text${suffix}`);
            const expandIcon = document.getElementById(`expand-icon${suffix}`);
            
            if (fullDiv && expandText && expandIcon) {
                const isExpanded = fullDiv.style.display === 'block';
                
                if (isExpanded) {
                    fullDiv.style.display = 'none';
                    expandText.textContent = 'Show more';
                    expandIcon.className = 'fas fa-chevron-down';
                } else {
                    fullDiv.style.display = 'block';
                    expandText.textContent = 'Show less';
                    expandIcon.className = 'fas fa-chevron-up';
                }
            }
        }

        function toggleStatus(type, messageId, toggleElement) {
            const message = messagesData.find(m => m.id === messageId);
            if (!message) return;
            
            const currentStatus = type === 'sent' ? message.sentStatus : message.replyStatus;
            let newStatus;
            
            // Cycle through: null -> true -> false -> null
            if (currentStatus === null || currentStatus === undefined) {
                newStatus = true;
            } else if (currentStatus === true) {
                newStatus = false;
            } else {
                newStatus = null;
            }
            
            // Update data
            if (type === 'sent') {
                message.sentStatus = newStatus;
            } else {
                message.replyStatus = newStatus;
            }
            
            // Update UI
            toggleElement.className = `toggle-switch ${getToggleClass(newStatus)} unsaved`;
            toggleElement.querySelector('.toggle-knob').textContent = getToggleIcon(newStatus);
            toggleElement.nextElementSibling.textContent = getToggleLabel(newStatus);
            
            markUnsaved(messageId);
        }

        function markUnsaved(messageId) {
            unsavedChanges.add(messageId);
            
            // Show save buttons
            const saveBtn = document.getElementById(`save-btn-${messageId}`);
            const saveBtnCard = document.getElementById(`save-btn-card-${messageId}`);
            
            if (saveBtn) {
                saveBtn.className = 'save-btn visible';
            }
            if (saveBtnCard) {
                saveBtnCard.className = 'save-btn visible';
            }
            
            // Add unsaved styling to comment field
            const commentField = document.getElementById(`comment-${messageId}`);
            const commentFieldCard = document.getElementById(`comment-card-${messageId}`);
            
            if (commentField) commentField.classList.add('unsaved');
            if (commentFieldCard) commentFieldCard.classList.add('unsaved');
        }

        // Dashboard messages preview functions
        function populateMessagesPreview() {
            const previewList = document.getElementById('messagesPreviewList');
            
            if (!previewList) return;
            
            // Use sample data (replace with API call in production)
            const messages = SAMPLE_MESSAGES.slice(0, 5); // Show first 5 messages
            
            if (messages.length === 0) {
                previewList.innerHTML = `
                    <div class="message-preview-empty">
                        <i class="fas fa-envelope-open-text"></i>
                        <h4>No Messages Yet</h4>
                        <p>Start your LinkedIn outreach campaigns to see messages here</p>
                    </div>
                `;
                return;
            }
            
            previewList.innerHTML = '';
            
            messages.forEach(message => {
                const previewItem = createMessagePreviewItem(message);
                previewList.appendChild(previewItem);
            });
        }

        function createMessagePreviewItem(message) {
            const item = document.createElement('div');
            item.className = 'message-preview-item';
            item.onclick = () => {
                showSection('messages');
                // Scroll to specific message if needed
                setTimeout(() => {
                    const messageRow = document.getElementById(`message-row-${message.id}`);
                    const messageCard = document.getElementById(`message-card-${message.id}`);
                    if (messageRow) messageRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    if (messageCard) messageCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            };
            
            const profileName = formatProfileName(message.targetProfile.firstName, message.targetProfile.lastName);
            const initials = getInitials(`${message.targetProfile.firstName} ${message.targetProfile.lastName}`);
            const truncatedMessage = truncateText(message.message, 80);
            
            // Determine status indicators
            let statusIndicators = '';
            if (message.sentStatus === true) {
                statusIndicators += '<div class="mini-status sent" title="Message Sent"></div>';
            }
            if (message.replyStatus === true) {
                statusIndicators += '<div class="mini-status replied" title="Got Reply"></div>';
            } else if (message.replyStatus === false) {
                statusIndicators += '<div class="mini-status no-reply" title="No Reply Yet"></div>';
            } else if (message.sentStatus === true) {
                statusIndicators += '<div class="mini-status pending" title="Waiting for Reply"></div>';
            }
            
            item.innerHTML = `
                <div class="message-preview-avatar">${initials}</div>
                <div class="message-preview-content">
                    <div class="message-preview-header">
                        <div class="message-preview-name">${profileName}</div>
                        <div class="message-preview-status">${statusIndicators}</div>
                    </div>
                    <div class="message-preview-company">${message.targetProfile.company}</div>
                    <div class="message-preview-text">${truncatedMessage}</div>
                </div>
            `;
            
            return item;
        }

        // Message interaction functions
        function toggleMessageExpansion(messageId, type = 'table') {
            const suffix = type === 'card' ? `-card-${messageId}` : `-${messageId}`;
            const fullDiv = document.getElementById(`message-full${suffix}`);
            const expandText = document.getElementById(`expand-text${suffix}`);
            const expandIcon = document.getElementById(`expand-icon${suffix}`);
            
            if (fullDiv && expandText && expandIcon) {
                const isExpanded = fullDiv.style.display === 'block';
                
                if (isExpanded) {
                    fullDiv.style.display = 'none';
                    expandText.textContent = 'Show more';
                    expandIcon.className = 'fas fa-chevron-down';
                } else {
                    fullDiv.style.display = 'block';
                    expandText.textContent = 'Show less';
                    expandIcon.className = 'fas fa-chevron-up';
                }
            }
        }

        function toggleStatus(type, messageId, toggleElement) {
            const message = messagesData.find(m => m.id === messageId);
            if (!message) return;
            
            const currentStatus = type === 'sent' ? message.sentStatus : message.replyStatus;
            let newStatus;
            
            // Cycle through: null -> true -> false -> null
            if (currentStatus === null || currentStatus === undefined) {
                newStatus = true;
            } else if (currentStatus === true) {
                newStatus = false;
            } else {
                newStatus = null;
            }
            
            // Update data
            if (type === 'sent') {
                message.sentStatus = newStatus;
            } else {
                message.replyStatus = newStatus;
                
                // Enable/disable reply content field based on reply status
                updateReplyContentField(messageId, newStatus);
            }
            
            // Update UI
            toggleElement.className = `toggle-switch ${getToggleClass(newStatus)} unsaved`;
            toggleElement.querySelector('.toggle-knob').textContent = getToggleIcon(newStatus);
            toggleElement.nextElementSibling.textContent = getToggleLabel(newStatus);
            
            markUnsaved(messageId);
        }

        function updateReplyContentField(messageId, replyStatus) {
            // Update both desktop and mobile reply content fields
            const replyField = document.getElementById(`reply-content-${messageId}`);
            const replyFieldCard = document.getElementById(`reply-content-card-${messageId}`);
            
            const isEnabled = replyStatus === true;
            const placeholder = isEnabled ? 'Enter the reply content received...' : 'Mark as replied first to add content';
            
            [replyField, replyFieldCard].forEach(field => {
                if (field) {
                    field.disabled = !isEnabled;
                    field.placeholder = placeholder;
                    if (!isEnabled && field.value) {
                        // Clear content if disabling field
                        field.value = '';
                        markUnsaved(messageId);
                    }
                }
            });
        }

        function markUnsaved(messageId) {
            unsavedChanges.add(messageId);
            
            // Show save buttons
            const saveBtn = document.getElementById(`save-btn-${messageId}`);
            const saveBtnCard = document.getElementById(`save-btn-card-${messageId}`);
            
            if (saveBtn) {
                saveBtn.className = 'save-btn visible';
            }
            if (saveBtnCard) {
                saveBtnCard.className = 'save-btn visible';
            }
            
            // Add unsaved styling to all editable fields
            const fields = [
                `comment-${messageId}`, `comment-card-${messageId}`,
                `reply-content-${messageId}`, `reply-content-card-${messageId}`,
                `action-${messageId}`, `action-card-${messageId}`
            ];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.classList.add('unsaved');
            });
        }

        async function saveMessageData(messageId) {
            const saveBtn = document.getElementById(`save-btn-${messageId}`);
            const saveBtnCard = document.getElementById(`save-btn-card-${messageId}`);
            const message = messagesData.find(m => m.id === messageId);
            
            if (!message) return;
            
            // Update button state to saving
            if (saveBtn) {
                saveBtn.className = 'save-btn saving';
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            }
            if (saveBtnCard) {
                saveBtnCard.className = 'save-btn saving';
                saveBtnCard.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            }
            
            try {
                // Get current field values
                const getFieldValue = (id) => {
                    const field = document.getElementById(id);
                    return field ? field.value : '';
                };
                
                const currentComment = getFieldValue(`comment-${messageId}`) || getFieldValue(`comment-card-${messageId}`);
                const currentReplyContent = getFieldValue(`reply-content-${messageId}`) || getFieldValue(`reply-content-card-${messageId}`);
                const currentAction = getFieldValue(`action-${messageId}`) || getFieldValue(`action-card-${messageId}`);
                
                // Prepare data to save
                const updateData = {
                    id: messageId,
                    sentStatus: message.sentStatus,
                    replyStatus: message.replyStatus,
                    replyContent: currentReplyContent,
                    comment: currentComment,
                    action: currentAction,
                    lastUpdated: new Date().toISOString()
                };
                
                // TODO: Replace with actual API call
                // const response = await fetch(`https://api.msgly.ai/messages/${messageId}`, {
                //     method: 'PATCH',
                //     headers: {
                //         'Authorization': `Bearer ${getAuthToken()}`,
                //         'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify(updateData)
                // });
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Update local data
                message.comment = currentComment;
                message.replyContent = currentReplyContent;
                message.action = currentAction;
                message.lastUpdated = updateData.lastUpdated;
                
                // Update UI to saved state
                unsavedChanges.delete(messageId);
                
                if (saveBtn) {
                    saveBtn.className = 'save-btn saved';
                    saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                    setTimeout(() => {
                        saveBtn.className = 'save-btn hidden';
                        saveBtn.innerHTML = '<i class="fas fa-save"></i> Save';
                    }, 2000);
                }
                
                if (saveBtnCard) {
                    saveBtnCard.className = 'save-btn saved';
                    saveBtnCard.innerHTML = '<i class="fas fa-check"></i> Saved!';
                    setTimeout(() => {
                        saveBtnCard.className = 'save-btn hidden';
                        saveBtnCard.innerHTML = '<i class="fas fa-save"></i> Save Changes';
                    }, 2000);
                }
                
                // Remove unsaved styling from all fields
                const fields = [
                    `comment-${messageId}`, `comment-card-${messageId}`,
                    `reply-content-${messageId}`, `reply-content-card-${messageId}`,
                    `action-${messageId}`, `action-card-${messageId}`
                ];
                
                fields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.classList.remove('unsaved');
                });
                
                // Remove unsaved styling from toggles
                document.querySelectorAll(`#message-row-${messageId} .toggle-switch, #message-card-${messageId} .toggle-switch`).forEach(toggle => {
                    toggle.classList.remove('unsaved');
                });
                
                // Update messages preview if on dashboard
                if (document.getElementById('dashboardSection').classList.contains('active')) {
                    populateMessagesPreview();
                }
                
                console.log('[MESSAGES] Saved message data:', updateData);
                
            } catch (error) {
                console.error('[MESSAGES] Error saving message:', error);
                
                // Reset button state on error
                if (saveBtn) {
                    saveBtn.className = 'save-btn visible';
                    saveBtn.innerHTML = '<i class="fas fa-save"></i> Save';
                }
                if (saveBtnCard) {
                    saveBtnCard.className = 'save-btn visible';
                    saveBtnCard.innerHTML = '<i class="fas fa-save"></i> Save Changes';
                }
                
                alert('Failed to save changes. Please try again.');
            }
        }

        function filterMessages() {
            const filterValue = document.getElementById('messageFilter').value;
            
            switch(filterValue) {
                case 'all':
                    filteredMessages = [...messagesData];
                    break;
                case 'sent':
                    filteredMessages = messagesData.filter(m => m.sentStatus === true);
                    break;
                case 'pending':
                    filteredMessages = messagesData.filter(m => m.sentStatus !== true);
                    break;
                case 'replied':
                    filteredMessages = messagesData.filter(m => m.replyStatus === true);
                    break;
                case 'no-reply':
                    filteredMessages = messagesData.filter(m => m.sentStatus === true && m.replyStatus === false);
                    break;
                default:
                    filteredMessages = [...messagesData];
            }
            
            renderMessages();
        }

        function refreshMessages() {
            const refreshBtn = document.querySelector('.refresh-btn');
            const icon = refreshBtn.querySelector('i');
            
            // Add spinning animation
            icon.classList.add('fa-spin');
            refreshBtn.disabled = true;
            
            // Reload messages
            setTimeout(() => {
                loadMessages();
                icon.classList.remove('fa-spin');
                refreshBtn.disabled = false;
            }, 1000);
        }

        // ENHANCED: subscription display with correct plan data mapping
        function updateSubscriptionDisplay(user) {
            // PLAN NAME MAPPING
            const planDisplayNames = {
                'free': 'Free Plan',
                'silver-monthly': 'Silver Monthly',
                'silver-payasyougo': 'Silver Pay-as-you-go',
                'gold-monthly': 'Gold Monthly', 
                'gold-payasyougo': 'Gold Pay-as-you-go',
                'platinum-monthly': 'Platinum Monthly',
                'platinum-payasyougo': 'Platinum Pay-as-you-go'
            };

            const planCode = user.planCode || 'free';
            const planDisplayName = planDisplayNames[planCode] || 'Unknown Plan';
            
            console.log('[DISPLAY] Updating plan display:', {
                planCode: planCode,
                displayName: planDisplayName,
                renewableCredits: user.renewableCredits,
                payasyougoCredits: user.payasyougoCredits,
                totalCredits: user.credits
            });

            // Update plan badge
            document.getElementById('currentPlan').textContent = planDisplayName;
            
            // Update plan badge color based on plan type
            const planBadge = document.getElementById('planBadge');
            if (planCode === 'free') {
                planBadge.style.background = 'linear-gradient(135deg, var(--gray) 0%, var(--dark-gray) 100%)';
            } else if (planCode.startsWith('silver')) {
                planBadge.style.background = 'linear-gradient(135deg, #6B7280 0%, #4B5563 100%)';
            } else if (planCode.startsWith('gold')) {
                planBadge.style.background = 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)';
            } else if (planCode.startsWith('platinum')) {
                planBadge.style.background = 'linear-gradient(135deg, var(--primary-purple) 0%, var(--dark-purple) 100%)';
            }

            // Display total credits and breakdown
            const totalCredits = user.credits || 0;
            const renewableCredits = user.renewableCredits || 0;
            const payasyougoCredits = user.payasyougoCredits || 0;
            
            document.getElementById('creditsRemaining').textContent = totalCredits;
            
            // Credit breakdown display
            const creditBreakdownEl = document.getElementById('creditBreakdown');
            const renewalInfoEl = document.getElementById('renewalInfo');
            
            if (payasyougoCredits > 0 && renewableCredits > 0) {
                creditBreakdownEl.textContent = `${payasyougoCredits} PAYG + ${renewableCredits} Monthly`;
                renewalInfoEl.textContent = `PAYG credits never expire  Monthly credits renew`;
            } else if (payasyougoCredits > 0) {
                creditBreakdownEl.textContent = `${payasyougoCredits} Pay-as-you-go credits`;
                renewalInfoEl.textContent = `Credits never expire`;
            } else if (renewableCredits > 0) {
                creditBreakdownEl.textContent = `${renewableCredits} Monthly credits`;
                renewalInfoEl.textContent = `Refreshes monthly`;
            } else {
                creditBreakdownEl.textContent = `${totalCredits} Credits`;
                renewalInfoEl.textContent = `Usage-based credits`;
            }

            // Update subscription status
            document.getElementById('subscriptionStatus').textContent = (user.subscriptionStatus || 'active').charAt(0).toUpperCase() + (user.subscriptionStatus || 'active').slice(1);
            
            // Billing model display
            let billingDisplay;
            if (planCode.includes('payasyougo')) {
                billingDisplay = 'One-time Purchase';
            } else if (planCode.includes('monthly')) {
                billingDisplay = 'Monthly Subscription';
            } else {
                billingDisplay = (user.billingModel || 'monthly').charAt(0).toUpperCase() + (user.billingModel || 'monthly').slice(1);
            }
            document.getElementById('billingModel').textContent = billingDisplay;

            // Messages sent
            document.getElementById('messagesSent').textContent = '0'; // TODO: Get from API
        }

        // TRAFFIC LIGHT FUNCTIONS
        function hideAllWarnings() {
            document.getElementById('redWarning').style.display = 'none';
            document.getElementById('orangeWarning').style.display = 'none';
        }

        function showRedWarning() {
            hideAllWarnings();
            document.getElementById('redWarning').style.display = 'block';
        }

        function showOrangeWarning() {
            hideAllWarnings();
            document.getElementById('orangeWarning').style.display = 'block';
            startAnalysisProgress();
        }

        function enableViewProfile() {
            const btn = document.getElementById('viewProfileBtn');
            const btnText = document.getElementById('profileBtnText');
            
            btn.classList.remove('disabled');
            btn.classList.add('enabled');
            btnText.innerHTML = '<i class="fas fa-eye"></i> View Full Profile';
        }

        function disableViewProfile() {
            const btn = document.getElementById('viewProfileBtn');
            const btnText = document.getElementById('profileBtnText');
            
            btn.classList.add('disabled');
            btn.classList.remove('enabled');
            
            if (trafficLightStatus === 'red') {
                btnText.innerHTML = '<i class="fas fa-sync-alt"></i> Complete profile sync first';
            } else if (trafficLightStatus === 'orange') {
                btnText.innerHTML = '<i class="fas fa-hourglass-half"></i> Analysis in progress...';
            }
        }

        function startAnalysisProgress() {
            let progress = 0;
            const progressFill = document.getElementById('analysisProgress');
            const progressText = document.getElementById('progressText');
            
            if (analysisProgressInterval) {
                clearInterval(analysisProgressInterval);
            }
            
            analysisProgressInterval = setInterval(() => {
                progress += Math.random() * 2;
                if (progress > 95) progress = 95;
                
                progressFill.style.width = `${progress}%`;
                
                if (progress < 30) {
                    progressText.textContent = 'Analyzing profile structure...';
                } else if (progress < 60) {
                    progressText.textContent = 'Processing experience data...';
                } else if (progress < 85) {
                    progressText.textContent = 'Extracting skills & certifications...';
                } else {
                    progressText.textContent = 'Finalizing analysis...';
                }
            }, 1000);
        }

        // FULL PROFILE VIEW FUNCTIONS
        function showFullProfile() {
            if (trafficLightStatus !== 'green') {
                alert('Please complete your profile sync first to view your full profile.');
                return;
            }

            const fullProfileSection = document.getElementById('fullProfileSection');
            const fullProfileContent = document.getElementById('fullProfileContent');
            
            const profile = currentUserData.profile;
            
            let profileHTML = `
                <!-- Basic Information -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <i class="fas fa-user"></i>
                        Basic Information
                    </div>
                    <div class="profile-grid">
                        <div class="profile-item">
                            <div class="profile-item-label">Full Name</div>
                            <div class="profile-item-value">${profile?.fullName || 'Not available'}</div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-item-label">Headline</div>
                            <div class="profile-item-value">${profile?.headline || 'Not available'}</div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-item-label">Current Role</div>
                            <div class="profile-item-value">${profile?.currentRole || 'Not available'}</div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-item-label">Location</div>
                            <div class="profile-item-value">${profile?.location || 'Not available'}</div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-item-label">Current Company</div>
                            <div class="profile-item-value">${profile?.currentCompanyName || profile?.currentCompany || 'Not available'}</div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-item-label">Connections</div>
                            <div class="profile-item-value">${profile?.connectionsCount || profile?.connections || 'Not available'}</div>
                        </div>
                    </div>
                </div>
            `;

            // Experience Section
            if (profile?.experience && Array.isArray(profile.experience) && profile.experience.length > 0) {
                profileHTML += `
                    <div class="profile-section">
                        <div class="profile-section-title">
                            <i class="fas fa-briefcase"></i>
                            Professional Experience (${profile.experience.length})
                        </div>
                `;
                
                profile.experience.forEach((exp, index) => {
                    profileHTML += `
                        <div class="experience-item">
                            <div class="item-title">${exp.title || exp.position || 'Position not specified'}</div>
                            <div class="item-company">${exp.company || exp.companyName || 'Company not specified'}</div>
                            <div class="item-duration">${exp.duration || exp.dateRange || 'Duration not specified'}</div>
                            ${exp.description ? `<div class="item-description">${exp.description}</div>` : ''}
                        </div>
                    `;
                });
                
                profileHTML += `</div>`;
            }

            // Education Section
            if (profile?.education && Array.isArray(profile.education) && profile.education.length > 0) {
                profileHTML += `
                    <div class="profile-section">
                        <div class="profile-section-title">
                            <i class="fas fa-graduation-cap"></i>
                            Education (${profile.education.length})
                        </div>
                `;
                
                profile.education.forEach((edu, index) => {
                    profileHTML += `
                        <div class="education-item">
                            <div class="item-title">${edu.degree || edu.field || 'Degree not specified'}</div>
                            <div class="item-company">${edu.school || edu.institution || 'Institution not specified'}</div>
                            <div class="item-duration">${edu.duration || edu.years || 'Years not specified'}</div>
                            ${edu.description ? `<div class="item-description">${edu.description}</div>` : ''}
                        </div>
                    `;
                });
                
                profileHTML += `</div>`;
            }

            // Skills Section
            if (profile?.skills && Array.isArray(profile.skills) && profile.skills.length > 0) {
                profileHTML += `
                    <div class="profile-section">
                        <div class="profile-section-title">
                            <i class="fas fa-tools"></i>
                            Skills & Expertise (${profile.skills.length})
                        </div>
                        <div class="skills-grid">
                `;
                
                profile.skills.forEach((skill, index) => {
                    const skillName = typeof skill === 'string' ? skill : skill.name || skill.skill;
                    const endorsements = typeof skill === 'object' ? skill.endorsements : '';
                    
                    profileHTML += `
                        <div class="skill-item">
                            <div class="skill-name">${skillName}</div>
                            ${endorsements ? `<div class="skill-endorsements">${endorsements} endorsements</div>` : ''}
                        </div>
                    `;
                });
                
                profileHTML += `</div></div>`;
            }

            // Certifications Section
            if (profile?.certifications && Array.isArray(profile.certifications) && profile.certifications.length > 0) {
                profileHTML += `
                    <div class="profile-section">
                        <div class="profile-section-title">
                            <i class="fas fa-certificate"></i>
                            Certifications (${profile.certifications.length})
                        </div>
                `;
                
                profile.certifications.forEach((cert, index) => {
                    profileHTML += `
                        <div class="certification-item">
                            <div class="item-title">${cert.name || cert.title || 'Certification not specified'}</div>
                            <div class="item-company">${cert.issuer || cert.organization || 'Issuer not specified'}</div>
                            <div class="item-duration">${cert.date || cert.issued || 'Date not specified'}</div>
                        </div>
                    `;
                });
                
                profileHTML += `</div>`;
            }

            // Awards Section
            if (profile?.awards && Array.isArray(profile.awards) && profile.awards.length > 0) {
                profileHTML += `
                    <div class="profile-section">
                        <div class="profile-section-title">
                            <i class="fas fa-trophy"></i>
                            Awards & Honors (${profile.awards.length})
                        </div>
                `;
                
                profile.awards.forEach((award, index) => {
                    profileHTML += `
                        <div class="award-item">
                            <div class="item-title">${award.name || award.title || 'Award not specified'}</div>
                            <div class="item-company">${award.issuer || award.organization || 'Issuer not specified'}</div>
                            <div class="item-duration">${award.date || award.year || 'Date not specified'}</div>
                            ${award.description ? `<div class="item-description">${award.description}</div>` : ''}
                        </div>
                    `;
                });
                
                profileHTML += `</div>`;
            }

            fullProfileContent.innerHTML = profileHTML;
            fullProfileSection.style.display = 'block';
            
            fullProfileSection.scrollIntoView({ behavior: 'smooth' });
        }

        function hideFullProfile() {
            document.getElementById('fullProfileSection').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorState').style.display = 'block';
        }

        function formatDate(dateString) {
            if (!dateString) return 'Not available';
            
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                return 'Invalid date';
            }
        }

        function getInitials(name) {
            if (!name) return '??';
            
            const parts = name.split(' ');
            if (parts.length >= 2) {
                return (parts[0][0] + parts[1][0]).toUpperCase();
            } else {
                return name.substring(0, 2).toUpperCase();
            }
        }

        function upgradeAccount() {
            alert('Upgrade functionality coming soon! Premium plans will be available shortly.');
        }

        function downloadChromeExtension() {
            const extensionUrl = 'https://chrome.google.com/webstore/detail/msgly-ai-extension/[your-extension-id]';
            window.open(extensionUrl, '_blank');
        }

        function logout() {
            localStorage.removeItem('authToken');
            window.location.href = '/login';
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.sidebar-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !toggle.contains(event.target) && 
                sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        });

        // Cleanup intervals on page unload
        window.addEventListener('beforeunload', function() {
            if (analysisProgressInterval) {
                clearInterval(analysisProgressInterval);
            }
        });
    </script>
</body>
</html>
